<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photosynthetic Pigments</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- MathJax CDN for rendering LaTeX formulas -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        /* Base styles for all screen sizes */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif; /* Changed font to Inter as per guidelines */
            scroll-behavior: smooth; /* Smooth scrolling for anchor links if any are added later */
        }

        :root {
            --primary: #2e7d32;
            --primary-dark: #1b5e20;
            --secondary: #ff8f00;
            --accent: #1565c0;
            --light: #f8f9fa;
            --dark: #212121;
            --gray: #6c757d;
        }

        body {
            background: linear-gradient(135deg, #e8f5e9, #f1f8e9);
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden; /* Prevent horizontal scroll on body */
        }

        header {
            background: linear-gradient(to right, var(--primary-dark), var(--primary));
            color: white;
            padding: 2rem 1rem; /* Adjusted padding for smaller screens */
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.1)"/></svg>');
            background-size: 100% 100%;
            opacity: 0.3;
        }

        h1 {
            font-size: 2.2rem; /* Adjusted font size for mobile */
            margin-bottom: 0.8rem;
            position: relative;
            z-index: 2;
        }

        .subtitle {
            font-size: 1rem; /* Adjusted font size for mobile */
            max-width: 800px;
            margin: 0 auto;
            opacity: 0.9;
            position: relative;
            z-index: 2;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem 1rem; /* Adjusted padding for smaller screens */
        }

        .section {
            background: white;
            border-radius: 12px;
            padding: 2rem 1.5rem; /* Adjusted padding for smaller screens */
            margin-bottom: 2rem; /* Adjusted margin */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .section:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            color: var(--primary-dark);
            font-size: 1.5rem; /* Adjusted font size for mobile */
            margin-bottom: 1.2rem;
            padding-bottom: 0.6rem;
            border-bottom: 3px solid var(--secondary);
            display: flex;
            align-items: center;
        }

        .section-title i {
            margin-right: 10px;
            background: var(--primary);
            color: white;
            width: 35px; /* Adjusted size */
            height: 35px; /* Adjusted size */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem; /* Adjusted icon size */
        }

        .columns {
            display: flex;
            gap: 1.5rem; /* Adjusted gap */
            margin: 1.5rem 0;
            flex-wrap: wrap; /* Allow columns to wrap on smaller screens */
        }

        .col {
            flex: 1;
            min-width: 300px; /* Ensure columns don't shrink too much before stacking */
        }

        .card {
            background: var(--light);
            border-radius: 10px;
            padding: 1.2rem; /* Adjusted padding */
            margin-bottom: 1.2rem;
            border-left: 4px solid var(--primary);
        }

        .card h3 {
            color: var(--primary-dark);
            margin-bottom: 0.6rem;
            font-size: 1.2rem; /* Adjusted font size */
        }

        .card ul {
            list-style-type: disc;
            padding-left: 1.2rem;
        }

        .card li {
            margin-bottom: 0.5rem;
        }

        .chart-container {
            height: 300px; /* Default height */
            margin: 1.5rem 0;
            position: relative;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 10px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            display: block; /* Ensure table can be scrolled horizontally */
            overflow-x: auto; /* Enable horizontal scrolling for tables */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
        }

        .comparison-table table {
            width: 100%;
            min-width: 600px; /* Minimum width to prevent content squishing */
        }

        .comparison-table th {
            background-color: var(--primary);
            color: white;
            padding: 1rem;
            text-align: left;
            border-bottom: 2px solid var(--primary-dark);
            white-space: nowrap; /* Prevent wrapping in headers */
        }

        .comparison-table td {
            padding: 1rem;
            border-bottom: 1px solid #eee;
            white-space: nowrap; /* Prevent wrapping in cells */
        }

        .comparison-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .comparison-table tr:hover {
            background-color: #f1f8e9;
        }

        .structure-diagram {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            margin: 1.5rem 0;
        }

        .molecule {
            display: inline-block;
            text-align: center;
            margin: 0.5rem; /* Adjusted margin */
            vertical-align: top; /* Align multiple molecules at the top */
        }

        .molecule img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            max-height: 250px; /* Limit image height */
        }

        .key-points {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Adjusted minmax for better mobile fit */
            gap: 1.2rem; /* Adjusted gap */
            margin: 2rem 0;
        }

        .key-point {
            background: linear-gradient(to bottom right, #e8f5e9, #f1f8e9);
            border-radius: 10px;
            padding: 1.2rem; /* Adjusted padding */
            border: 1px solid #c8e6c9;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
        }

        .key-point h3 {
            color: var(--primary-dark);
            margin-bottom: 0.6rem;
            display: flex;
            align-items: center;
            font-size: 1.1rem; /* Adjusted font size */
        }

        .key-point h3 i {
            margin-right: 8px;
            color: var(--primary);
            font-size: 1.0rem; /* Adjusted icon size */
        }

        .formula {
            text-align: center;
            font-size: 0.9rem; /* Further reduced font size for mobile */
            margin: 1.5rem 0;
            padding: 1rem;
            background-color: #f5f5f5;
            border-radius: 8px;
            border-left: 4px solid var(--accent);
            overflow-x: auto; /* Allow formula to scroll horizontally if long */
        }

        .emerson-buttons {
            display: flex;
            flex-wrap: wrap; /* Allow buttons to wrap on smaller screens */
            justify-content: center;
            gap: 1rem; /* Spacing between buttons */
            margin-top: 1.5rem;
        }

        .emerson-buttons button {
            background-color: var(--primary);
            color: white;
            padding: 0.8rem 1.2rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .emerson-buttons button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .emerson-buttons button:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        /* Styling for the new blue reset button */
        .emerson-buttons button#resetEmerson {
            background-color: #1565c0; /* Accent blue */
        }

        .emerson-buttons button#resetEmerson:hover {
            background-color: #0d47a1; /* Darker blue on hover */
        }

        /* Quiz styles */
        .quiz-question {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background-color: #f8f8f8;
            border-radius: 8px;
            border: 1px solid #eee;
        }
        .quiz-question p {
            font-weight: bold;
            margin-bottom: 0.8rem;
        }
        .quiz-options label {
            display: block;
            margin-bottom: 0.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }
        .quiz-options label:hover {
            background-color: #e6ffe6; /* Light green hover */
        }
        .quiz-options input[type="radio"] {
            margin-right: 0.5rem;
        }
        .quiz-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }
        .quiz-buttons button {
            padding: 0.8rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            color: white;
        }
        .quiz-buttons button#submitQuiz {
            background-color: var(--primary);
        }
        .quiz-buttons button#submitQuiz:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }
        .quiz-buttons button#resetQuiz {
            background-color: var(--accent);
        }
        .quiz-buttons button#resetQuiz:hover {
            background-color: #0d47a1;
            transform: translateY(-2px);
        }

        .correct-answer {
            color: green;
            font-weight: bold;
        }
        .incorrect-answer {
            color: red;
            font-weight: bold;
        }

        /* Media queries for responsiveness */
        /* Extra small devices (phones, 600px and down) */
        @media only screen and (max-width: 600px) {
            h1 {
                font-size: 1.8rem;
            }

            .subtitle {
                font-size: 0.9rem;
            }

            .container {
                padding: 1rem 0.8rem;
            }

            .section {
                padding: 1.5rem 1rem;
                margin-bottom: 1.5rem;
            }

            .section-title {
                font-size: 1.3rem;
            }

            .section-title i {
                width: 30px;
                height: 30px;
                font-size: 1rem;
            }

            .columns {
                flex-direction: column;
                gap: 1rem;
            }

            .col {
                min-width: unset; /* Remove min-width to allow full flexibility */
            }

            .card {
                padding: 1rem;
                margin-bottom: 1rem;
            }

            .card h3 {
                font-size: 1.1rem;
            }

            .chart-container {
                height: 250px; /* Smaller height for very small screens */
                margin: 1rem 0;
            }

            .comparison-table th, .comparison-table td {
                padding: 0.8rem;
                font-size: 0.9rem;
            }

            .key-points {
                grid-template-columns: 1fr; /* Stack key points vertically */
                gap: 1rem;
            }

            .key-point {
                padding: 1rem;
            }

            .key-point h3 {
                font-size: 1rem;
            }

            .formula {
                font-size: 0.8rem; /* Further adjusted for extra small screens */
                padding: 0.8rem;
            }

            .emerson-buttons button, .quiz-buttons button {
                width: 100%; /* Full width buttons on small screens */
            }
        }

        /* Small devices (tablts, 768px and up) */
        @media only screen and (min-width: 601px) and (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .subtitle {
                font-size: 1rem;
            }

            .container {
                padding: 1.5rem 1rem;
            }

            .section {
                padding: 1.8rem 1.2rem;
            }

            .section-title {
                font-size: 1.4rem;
            }

            .chart-container {
                height: 280px;
            }

            .columns {
                flex-direction: column; /* Stack columns on tablets */
            }

            .key-points {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* Keep two columns if possible */
            }

            .formula {
                font-size: 0.9rem; /* Adjusted for small screens */
            }
        }

        /* Medium devices (laptops, 992px and up) */
        @media only screen and (min-width: 769px) and (max-width: 992px) {
            .container {
                padding: 2rem;
            }
            .columns {
                flex-direction: row; /* Resume horizontal columns */
            }
            .formula {
                font-size: 1rem; /* Adjusted for medium screens */
            }
        }

        /* Large devices (desktops, 1200px and up) */
        @media only screen and (min-width: 993px) {
            h1 {
                font-size: 2.8rem;
            }

            .subtitle {
                font-size: 1.2rem;
            }

            .container {
                padding: 2rem;
            }

            .section {
                padding: 2.5rem;
            }

            .section-title {
                font-size: 1.8rem;
            }

            .section-title i {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }

            .columns {
                flex-direction: row;
                gap: 2rem;
            }

            .chart-container {
                height: 300px;
            }

            .key-points {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 1.5rem;
            }
            .formula {
                font-size: 1.1rem; /* Adjusted for large screens */
            }
        }
    </style>
</head>
<body>
    <header>
        <h1><i class="fas fa-leaf"></i> Photosynthetic Pigments</h1>
        <p class="subtitle">Comprehensive coverage of structure, absorption spectra, quantum yield, and photochemical phenomena.</p>
    </header>

    <div class="container">
        <section class="section">
            <h2 class="section-title"><i class="fas fa-seedling"></i> Introduction</h2>
            <p>Photosynthetic pigments are specialized molecules that absorb light energy and drive electron transport in photosynthesis. These pigments are classified into three main categories: <strong>chlorophylls</strong>, <strong>carotenoids</strong>, and <strong>phycobilins</strong>. Each class has distinct structural features and absorption properties that enable plants, algae, and cyanobacteria to capture solar energy efficiently across the visible spectrum.</p>
            
            <div class="key-points">
                <div class="key-point">
                    <h3><i class="fas fa-lightbulb"></i> Core Function</h3>
                    <p>Absorb photons and transfer energy to reaction centers where photochemistry occurs, initiating the electron transport chain.</p>
                </div>
                <div class="key-point">
                    <h3><i class="fas fa-sun"></i> Energy Capture</h3>
                    <p>Pigments absorb specific wavelengths of light, converting solar energy into chemical energy with high efficiency.</p>
                </div>
                <div class="key-point">
                    <h3><i class="fas fa-shield-alt"></i> Photoprotection</h3>
                    <p>Accessory pigments protect photosynthetic apparatus from photooxidative damage by dissipating excess energy.</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2 class="section-title"><i class="fas fa-atom"></i> Pigment Structures</h2>
            
            <div class="columns">
                <div class="col">
                    <div class="card">
                        <h3>Chlorophylls</h3>
                        <p>Chlorophylls feature a <strong>porphyrin ring</strong> (tetrapyrrole structure) with a central Mg²⁺ ion coordinated by four nitrogen atoms. The molecule has:</p>
                        <ul>
                            <li>A hydrophobic <strong>phytol tail</strong> (C₂₀H₃₉) that anchors it to thylakoid membranes</li>
                            <li>A conjugated double-bond system that enables light absorption</li>
                            <li>Peripheral substituents that differ between types:
                                <ul>
                                    <li><strong>Chlorophyll a</strong>: Methyl group (-CH₃) at C-7 position</li>
                                    <li><strong>Chlorophyll b</strong>: Formyl group (-CHO) at C-7 position</li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="structure-diagram">
                        <h3>Chlorophyll a Molecular Structure</h3>
                        <div class="molecule">
                            <!-- Chlorophyll a structure image updated -->
                            <img src="https://betabiosciences.github.io/Biochemistry-animations/Chlorophyll%20structure.png" 
                                 alt="Chlorophyll a structure showing porphyrin ring with Mg²⁺ center and phytol tail">
                            <p>Chlorophyll a structure showing porphyrin ring with Mg²⁺ center and phytol tail</p>
                        </div>
                    </div>
                </div>
                
                <div class="col">
                    <div class="card">
                        <h3>Carotenoids</h3>
                        <p>Carotenoids consist of <strong>polyene chains</strong> with conjugated double bonds and ionone rings. They are classified as:</p>
                        <ul>
                            <li><strong>Carotenes</strong>: Hydrocarbons (e.g., β-carotene)</li>
                            <li><strong>Xanthophylls</strong>: Oxygenated derivatives (e.g., lutein, violaxanthin)</li>
                        </ul>
                    </div>
                    
                    <div class="card">
                        <h3>Phycobilins</h3>
                        <p>Phycobilins are <strong>linear tetrapyrroles</strong> without Mg²⁺ or phytol tail. Examples include:</p>
                        <ul>
                            <li><strong>Phycoerythrobilin</strong> (red pigment in red algae)</li>
                            <li><strong>Phycocyanobilin</strong> (blue pigment in cyanobacteria)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section class="section">
            <h2 class="section-title"><i class="fas fa-chart-line"></i> Absorption Spectra</h2>
            
            <div class="card">
                <h3>Key Absorption Bands</h3>
                <ul>
                    <li><strong>Soret (B) Band</strong>: High-energy absorption in blue-violet region (400-500 nm)</li>
                    <li><strong>Q-Band</strong>: Lower-energy absorption in red region (600-700 nm), consisting of:
                        <ul>
                            <li><strong>Qx band</strong>: Results when chlorophylls excite to Singlet state S2</li>
                            <li><strong>Qy band</strong>: Results when chlorophylls excite to Singlet state S1</li>
                        </ul>
                    </li>
                    <li><strong>Green Gap</strong>: Minimal absorption at 500-600 nm (causes green appearance of plants)</li>
                    <li><strong>Soret band of Chlorophyll b is Red shifted (longer wavelength) and Q-band Blue shifted (shorter wavelength) when compared to Chlorophyll a</strong></li>
                </ul>
            </div>
            
            <div class="chart-container">
                <canvas id="absorptionChart"></canvas>
            </div>
            
            <div class="card">
                <h3>Soret Band Comparison: Chlorophyll a vs b</h3>
                <div class="comparison-table"> <!-- Wrap table in a div for scrollability -->
                    <table>
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Chlorophyll a</th>
                                <th>Chlorophyll b</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Peak Wavelength</td>
                                <td>428-432 nm</td>
                                <td>452-457 nm</td>
                            </tr>
                            <tr>
                                <td>Molar Extinction Coefficient</td>
                                <td>~120,000 M⁻¹cm⁻¹</td>
                                <td>~90,000 M⁻¹cm⁻¹</td>
                            </tr>
                            <tr>
                                <td>Structural Cause</td>
                                <td>Methyl group at C-7</td>
                                <td>Formyl group at C-7</td>
                            </tr>
                            <tr>
                                <td>Energy Level</td>
                                <td>Higher energy absorption</td>
                                <td>Lower energy absorption</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section class="section">
            <h2 class="section-title"><i class="fas fa-wave-square"></i> Action Spectra & Quantum Yield</h2>
            
            <div class="columns">
                <div class="col">
                    <div class="card">
                        <h3>Action Spectrum vs Absorption Spectrum</h3>
                        <ul>
                            <li><strong>Absorption Spectrum</strong>: Measures wavelengths absorbed by pigments</li>
                            <li><strong>Action Spectrum</strong>: Measures photosynthetic rate at different wavelength of light</li>
                            <li>Action spectra of photosynthesis will absolutely correlate the Absorption spectra of chlorophylls</li>
                        </ul>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="actionChart"></canvas>
                    </div>
                </div>
                
                <div class="col">
                    <div class="card">
                        <h3>Quantum Yield (Φ)</h3>
                        <p>Quantum yield measures the efficiency of photosynthesis:</p>
                        <div class="formula">
                            $$\Phi = \frac{\text{Number of O₂ molecules produced}}{\text{Number of photons absorbed}}$$
                        </div>
                        <ul>
                            <li>Maximum Φ: 0.10-0.125 (8-10 photons per O₂ molecule)</li>
                            <li>Peak efficiency at 680 nm</li>
                        </ul>
                    </div>
                    
                    <div class="card">
                        <h3>Red Drop Effect</h3>
                        <p>Sharp decline in quantum yield beyond 680 nm due to:</p>
                        <ul>
                            <li>Imbalance in energy supply to PSII and PSI</li>
                            <li>PSII absorption decreases above 680 nm</li>
                            <li>PSI absorbs far-red light but can't function alone</li>
                        </ul>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="redDropChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section class="section">
            <h2 class="section-title"><i class="fas fa-magic"></i> Emerson Enhancement Effect</h2>
            <div class="card">
                <h3>Understanding the Enhancement Effect</h3>
                <p>The Emerson Enhancement Effect demonstrates that the efficiency of photosynthesis significantly increases when plants are exposed simultaneously to both red light (around 680 nm) and far-red light (above 700 nm), compared to the sum of the photosynthetic rates achieved when exposed to each wavelength individually.</p>
                <ul>
                    <li>This effect revealed the existence of two distinct photosystems, Photosystem I (PSI) and Photosystem II (PSII), which work synergistically.</li>
                    <li>PSII absorbs effectively at 680 nm, while PSI absorbs effectively at wavelengths greater than 680 nm (far-red light).</li>
                    <li>For optimal photosynthesis, both photosystems must be excited; a single wavelength alone is insufficient beyond the red drop.</li>
                </ul>
            </div>
            <div class="chart-container">
                <canvas id="emersonEnhancementChart"></canvas>
            </div>
            <div class="emerson-buttons">
                <button id="showRed">Show Red Light (680nm Only)</button>
                <button id="showFarRed">Show Far-Red Light (700nm Only)</button>
                <button id="showIndividualSum">Show Individual Sum (Red + Far-Red)</button>
                <button id="showCombined">Show Observed Combined (Red + Far-Red)</button>
                <button id="resetEmerson">Reset Graph</button>
            </div>
        </section>

        <section class="section">
            <h2 class="section-title"><i class="fas fa-question-circle"></i> Review Quiz</h2>
            <div id="quizContainer">
                <!-- Quiz questions will be rendered here by JavaScript -->
            </div>
            <div class="quiz-buttons">
                <button id="submitQuiz">Submit Answers</button>
                <button id="resetQuiz">Reset Quiz</button>
            </div>
        </section>

    </div>

    <!-- Chart.js and plugin scripts moved to end of body for better loading order -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.0/dist/chartjs-plugin-annotation.min.js"></script>

    <script>
        // All chart initialization and plugin registration logic is now inside window.onload
        window.onload = function() {
            // The chartjs-plugin-annotation v2.x should auto-register itself with Chart.js v3.x
            // when loaded, provided Chart.js is already present.

            // Configure MathJax to process LaTeX in the document
            // This configuration ensures that MathJax looks for LaTeX delimiters ($...$)
            // and renders them correctly. It's set up to run automatically after the page loads.
            window.MathJax = {
                tex: {
                    inlineMath: [['$', '$'], ['\\(', '\\)']],
                    displayMath: [['$$', '$$']] // Added for block equations
                },
                svg: {
                    fontCache: 'global'
                },
                startup: {
                    ready: () => {
                        MathJax.startup.defaultReady();
                    }
                }
            };

            // Function to generate data for absorption charts based on wavelength
            const generateAbsorptionData = (start, end, func) => {
                const data = [];
                for (let i = start; i <= end; i += 5) { // Increment by 5nm for smoother data
                    data.push(func(i));
                }
                return data;
            };

            // Absorption Spectra Chart
            const absorptionCtx = document.getElementById('absorptionChart').getContext('2d');
            new Chart(absorptionCtx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 71}, (_, i) => 400 + i * 5), // Labels from 400 to 750 nm
                    datasets: [
                        {
                            label: 'Chlorophyll a',
                            data: generateAbsorptionData(400, 750, (x) => {
                                // Gaussian peaks for Soret (blue) and Q (red) bands
                                return (
                                    Math.exp(-Math.pow(x - 430, 2) / 500) * 0.9 + // Soret band
                                    Math.exp(-Math.pow(x - 662, 2) / 2000) * 0.7 // Q-band
                                );
                            }),
                            borderColor: '#388E3C',
                            backgroundColor: 'rgba(56, 142, 60, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0 // Hide data points for cleaner look
                        },
                        {
                            label: 'Chlorophyll b',
                            data: generateAbsorptionData(400, 750, (x) => {
                                // Gaussian peaks for Soret (blue) and Q (red) bands, shifted
                                return (
                                    Math.exp(-Math.pow(x - 453, 2) / 500) * 0.7 + // Soret band (red-shifted)
                                    Math.exp(-Math.pow(x - 643, 2) / 2000) * 0.6 // Q-band (blue-shifted)
                                );
                            }),
                            borderColor: '#7CB342',
                            backgroundColor: 'rgba(124, 179, 66, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Absorption Spectra of Chlorophyll a and b',
                            font: { size: 16 }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                title: function(tooltipItems) {
                                    return `Wavelength: ${tooltipItems[0].label} nm`;
                                },
                                label: function(tooltipItem) {
                                    return `${tooltipItem.dataset.label}: ${tooltipItem.formattedValue}`;
                                }
                            }
                        },
                        annotation: {
                            annotations: {
                                soretBand: {
                                    type: 'box',
                                    xMin: 400,
                                    xMax: 500,
                                    backgroundColor: 'rgba(33, 150, 243, 0.1)',
                                    borderColor: 'rgba(33, 150, 243, 0.5)',
                                    borderWidth: 1,
                                    label: {
                                        display: true,
                                        content: 'Soret Band',
                                        position: 'start',
                                        font: { size: 10, weight: 'bold' },
                                        color: '#1565c0'
                                    }
                                },
                                greenGap: {
                                    type: 'box',
                                    xMin: 500,
                                    xMax: 600,
                                    backgroundColor: 'rgba(76, 175, 80, 0.1)',
                                    borderColor: 'rgba(76, 175, 80, 0.5)',
                                    borderWidth: 1,
                                    label: {
                                        display: true,
                                        content: 'Green Gap',
                                        position: 'center',
                                        font: { size: 10, weight: 'bold' },
                                        color: '#4CAF50'
                                    }
                                }
                                ,
                                qBand: {
                                    type: 'box',
                                    xMin: 600,
                                    xMax: 700,
                                    backgroundColor: 'rgba(244, 67, 54, 0.1)',
                                    borderColor: 'rgba(244, 67, 54, 0.5)',
                                    borderWidth: 1,
                                    label: {
                                        display: true,
                                        content: 'Q-Band',
                                        position: 'end',
                                        font: { size: 10, weight: 'bold' },
                                        color: '#D32F2F'
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Wavelength (nm)',
                                font: { size: 12, weight: 'bold' }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            },
                            ticks: {
                                font: { size: 10 }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Relative Absorbance',
                                font: { size: 12, weight: 'bold' }
                            },
                            min: 0,
                            max: 1,
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            },
                            ticks: {
                                font: { size: 10 }
                            }
                        }
                    }
                }
            });

            // Action Spectrum Chart
            const actionCtx = document.getElementById('actionChart').getContext('2d');
            new Chart(actionCtx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 71}, (_, i) => 400 + i * 5),
                    datasets: [
                        {
                            label: 'Absorption Spectrum (Chl a)',
                            data: generateAbsorptionData(400, 750, (x) => {
                                return (
                                    Math.exp(-Math.pow(x - 430, 2) / 500) * 0.9 +
                                    Math.exp(-Math.pow(x - 662, 2) / 2000) * 0.7
                                );
                            }),
                            borderColor: '#388E3C',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.4,
                            pointRadius: 0
                        },
                        {
                            label: 'Action Spectrum (Photosynthesis)',
                            data: generateAbsorptionData(400, 750, (x) => {
                                // Slightly higher and broader peaks for action spectrum
                                return (
                                    (Math.exp(-Math.pow(x - 430, 2) / 500) * 0.9 +
                                    Math.exp(-Math.pow(x - 662, 2) / 2000) * 0.7) * 1.1 +
                                    Math.exp(-Math.pow(x - 470, 2) / 1000) * 0.2 + // Contribution from carotenoids
                                    Math.exp(-Math.pow(x - 550, 2) / 2000) * 0.1 // Small contribution from phycobilins if present
                                );
                            }),
                            borderColor: '#D32F2F',
                            backgroundColor: 'rgba(211, 47, 47, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Action Spectrum vs. Absorption Spectrum',
                            font: { size: 16 }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                title: function(tooltipItems) {
                                    return `Wavelength: ${tooltipItems[0].label} nm`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Wavelength (nm)',
                                font: { size: 12, weight: 'bold' }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            },
                            ticks: {
                                font: { size: 10 }
                            }
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Relative Rate',
                            font: { size: 12, weight: 'bold' }
                            },
                            min: 0,
                            max: 1.2, // Adjusted max for action spectrum
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            },
                            ticks: {
                                font: { size: 10 }
                            }
                        }
                    }
                });

            // Red Drop Effect Chart
            const redDropCtx = document.getElementById('redDropChart').getContext('2d');
            new Chart(redDropCtx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 41}, (_, i) => 600 + i * 5), // Labels from 600 to 800 nm
                    datasets: [
                        {
                            label: 'Quantum Yield (Φ)',
                            data: generateAbsorptionData(600, 800, (x) => {
                                if (x <= 680) {
                                    return 0.125; // Constant high quantum yield up to 680 nm
                                } else if (x > 680 && x <= 720) {
                                    // Gradual drop after 680 nm
                                    return 0.125 * Math.exp(-(x - 680) / 40);
                                } else {
                                    return 0.125 * Math.exp(-(x - 680) / 40) * 0.5; // Continue decreasing at a slower rate
                                }
                            }),
                            borderColor: '#7B1FA2',
                            backgroundColor: 'rgba(123, 31, 162, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.2,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Red Drop Effect in Quantum Yield',
                            font: { size: 16 }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                title: function(tooltipItems) {
                                    return `Wavelength: ${tooltipItems[0].label} nm`;
                                }
                            }
                        },
                        annotation: {
                            annotations: {
                                redDropLine: { // Changed ID to avoid conflict with 'redDrop' object
                                    type: 'line',
                                    xMin: 680,
                                    xMax: 680,
                                    borderColor: '#D32F2F',
                                    borderWidth: 2,
                                    borderDash: [6, 6],
                                    label: {
                                        display: true,
                                        content: 'Red Drop begins',
                                        position: 'start',
                                        font: { size: 10, weight: 'bold' },
                                        color: '#D32F2F',
                                        yAdjust: -10
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Wavelength (nm)',
                                font: { size: 12, weight: 'bold' }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            },
                            ticks: {
                                font: { size: 10 }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Quantum Yield (Φ)',
                                font: { size: 12, weight: 'bold' }
                            },
                            min: 0,
                            max: 0.14,
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            },
                            ticks: {
                                font: { size: 10 }
                            }
                        }
                    }
                }
            });

            // Emerson Enhancement Effect Chart
            const emersonCtx = document.getElementById('emersonEnhancementChart').getContext('2d');
            const emersonChartData = {
                labels: ['Red Light (680nm)', 'Far-Red Light (700nm)', 'Individual Sum (Red + Far-Red)', 'Observed Combined (Red + Far-Red)'],
                // These are the full data points, we will selectively show them
                originalData: [5, 2, 7, 15] // Example data: 5 (red) + 2 (far-red) = 7 (sum), but observed is 15
            };

            const emersonEnhancementChart = new Chart(emersonCtx, {
                type: 'bar', // Using bar chart for clearer comparison
                data: {
                    labels: emersonChartData.labels,
                    datasets: [{
                        label: 'Photosynthetic Rate',
                        // Initialize with zero or relevant default if desired
                        data: [0, 0, 0, 0], // Start with all bars at zero
                        backgroundColor: [
                            'rgba(244, 67, 54, 0.7)',    // Red light
                            'rgba(123, 31, 162, 0.7)',   // Far-red light
                            'rgba(96, 125, 139, 0.7)',   // Expected sum (grayish)
                            'rgba(56, 142, 60, 0.8)'     // Observed combined (primary green)
                        ],
                        borderColor: [
                            'rgba(244, 67, 54, 1)',
                            'rgba(123, 31, 162, 1)',
                            'rgba(96, 125, 139, 1)',
                            'rgba(56, 142, 60, 1)'
                        ],
                        borderWidth: 1,
                        borderRadius: 8 // Rounded corners for bars
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Emerson Enhancement Effect',
                            font: { size: 16 }
                        },
                        legend: {
                            display: false // No need for legend as labels are descriptive
                        },
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    return tooltipItems[0].label;
                                },
                                label: function(tooltipItem) {
                                    return `Rate: ${tooltipItem.formattedValue}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Light Condition',
                                font: { size: 12, weight: 'bold' }
                            },
                            grid: {
                                display: false // No vertical grid lines
                            },
                            ticks: {
                                font: { size: 10 }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Photosynthetic Rate (arbitrary units)',
                                font: { size: 12, weight: 'bold' }
                            },
                            beginAtZero: true,
                            max: 18, // Adjust max based on data
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            },
                            ticks: {
                                font: { size: 10 }
                            }
                        }
                    },
                    animation: {
                        duration: 800 // Smooth animation for bar changes
                    }
                }
            });

            // Event Listeners for Emerson buttons
            document.getElementById('showRed').addEventListener('click', () => {
                emersonEnhancementChart.data.datasets[0].data = [emersonChartData.originalData[0], 0, 0, 0];
                emersonEnhancementChart.update();
            });

            document.getElementById('showFarRed').addEventListener('click', () => {
                emersonEnhancementChart.data.datasets[0].data = [0, emersonChartData.originalData[1], 0, 0];
                emersonEnhancementChart.update();
            });

            document.getElementById('showIndividualSum').addEventListener('click', () => {
                emersonEnhancementChart.data.datasets[0].data = [0, 0, emersonChartData.originalData[2], 0];
                emersonEnhancementChart.update();
            });

            document.getElementById('showCombined').addEventListener('click', () => {
                emersonEnhancementChart.data.datasets[0].data = [0, 0, 0, emersonChartData.originalData[3]];
                emersonEnhancementChart.update();
            });

            document.getElementById('resetEmerson').addEventListener('click', () => {
                emersonEnhancementChart.data.datasets[0].data = [0, 0, 0, 0]; // Set all to zero
                emersonEnhancementChart.update();
            });

            // Initially show no bars, or you could show one of the states by default
            emersonEnhancementChart.data.datasets[0].data = [0, 0, 0, 0];
            emersonEnhancementChart.update();


            // --- Quiz Logic ---
            const quizData = [
                {
                    question: "Which of the following structural features distinguishes chlorophyll b from chlorophyll a?",
                    options: [
                        "A. Presence of a central Fe²⁺ ion",
                        "B. Replacement of –CH₃ with –CHO at C7 position",
                        "C. Absence of the phytol tail",
                        "D. Substitution of Mg²⁺ with Zn²⁺"
                    ],
                    correctAnswerIndex: 1 // B
                },
                {
                    question: "What is the function of carotenoids in the photosynthetic apparatus?",
                    options: [
                        "A. Catalyze the splitting of water",
                        "B. Reduce NADP⁺ to NADPH",
                        "C. Harvest green light for Photosystem II",
                        "D. Prevent oxidative damage and extend light absorption"
                    ],
                    correctAnswerIndex: 3 // D
                },
                {
                    question: "Which of the following best explains the “red drop effect”?",
                    options: [
                        "A. Decrease in chlorophyll fluorescence beyond 700 nm",
                        "B. Reduced ATP synthesis above 600 nm",
                        "C. Sharp drop in quantum yield of photosynthesis beyond 680 nm",
                        "D. Sudden enhancement in CO₂ fixation beyond 700 nm"
                    ],
                    correctAnswerIndex: 2 // C
                },
                {
                    question: "In an action spectrum of photosynthesis in plants, which regions show peak activity?",
                    options: [
                        "A. 400–450 nm and 680–700 nm",
                        "B. 500–600 nm only",
                        "C. 450–550 nm and 620–640 nm",
                        "D. 700–800 nm only"
                    ],
                    correctAnswerIndex: 0 // A
                },
                {
                    question: "Which transition is associated with the Soret band in chlorophyll?",
                    options: [
                        "A) π→π* transition in the porphyrin ring",
                        "B) n→π* transition of the phytol tail",
                        "C) Mg²⁺ ionization",
                        "D) Singlet-to-triplet transition"
                    ],
                    correctAnswerIndex: 0 // A
                },
                {
                    question: "The quantum yield (Φ) of photosynthesis is calculated as:",
                    options: [
                        "A) CO₂ fixed per photon absorbed",
                        "B) O₂ evolved per photon absorbed",
                        "C) ATP synthesized per photon absorbed",
                        "D) NADPH produced per photon absorbed"
                    ],
                    correctAnswerIndex: 1 // B
                }
            ];

            const quizContainer = document.getElementById('quizContainer');
            const submitQuizBtn = document.getElementById('submitQuiz');
            const resetQuizBtn = document.getElementById('resetQuiz');

            function renderQuiz() {
                quizContainer.innerHTML = ''; // Clear previous quiz
                quizData.forEach((q, index) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.classList.add('quiz-question');
                    questionDiv.innerHTML = `<p>${index + 1}. ${q.question}</p>`;

                    const optionsDiv = document.createElement('div');
                    optionsDiv.classList.add('quiz-options');

                    q.options.forEach((option, optionIndex) => {
                        const label = document.createElement('label');
                        label.innerHTML = `
                            <input type="radio" name="question${index}" value="${optionIndex}">
                            ${option}
                        `;
                        optionsDiv.appendChild(label);
                    });
                    questionDiv.appendChild(optionsDiv);
                    quizContainer.appendChild(questionDiv);
                });
            }

            function submitQuiz() {
                quizData.forEach((q, index) => {
                    const selectedOption = document.querySelector(`input[name="question${index}"]:checked`);
                    const questionDiv = quizContainer.children[index];
                    const optionsLabels = questionDiv.querySelectorAll('label');

                    // Disable all radio buttons for this question
                    questionDiv.querySelectorAll('input[type="radio"]').forEach(radio => radio.disabled = true);

                    if (selectedOption) {
                        const userAnswerIndex = parseInt(selectedOption.value);
                        if (userAnswerIndex === q.correctAnswerIndex) {
                            optionsLabels[userAnswerIndex].classList.add('correct-answer');
                        } else {
                            optionsLabels[userAnswerIndex].classList.add('incorrect-answer');
                            optionsLabels[q.correctAnswerIndex].classList.add('correct-answer'); // Show correct answer
                        }
                    } else {
                        // If no answer selected, just show the correct one
                        optionsLabels[q.correctAnswerIndex].classList.add('correct-answer');
                    }
                });
            }

            function resetQuiz() {
                quizData.forEach((q, index) => {
                    const questionDiv = quizContainer.children[index];
                    const optionsLabels = questionDiv.querySelectorAll('label');

                    // Remove all styling
                    optionsLabels.forEach(label => {
                        label.classList.remove('correct-answer', 'incorrect-answer');
                    });

                    // Deselect all radio buttons and re-enable them
                    questionDiv.querySelectorAll('input[type="radio"]').forEach(radio => {
                        radio.checked = false;
                        radio.disabled = false;
                    });
                });
            }

            // Initial render of the quiz
            renderQuiz();

            // Attach event listeners to quiz buttons
            submitQuizBtn.addEventListener('click', submitQuiz);
            resetQuizBtn.addEventListener('click', resetQuiz);
        }; // End of window.onload
    </script>
</body>
</html>
